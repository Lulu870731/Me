// File: Combined_DualThrust_ChipFlow.eld

// Step 1: Define inputs and variables for Dual Thrust
Inputs: K1(0.5), K2(0.5), Nday(5);
Vars: HH(0), HC(0), LL(0), LC(0);
Vars: vRange(0);
Vars: vOpen(0), Upperline(0), Bottomline(0);

// Step 2: Define variables for Chip Flow (Inner vs Outer Volume Difference)
Vars: ChipFlow(0), SignalColor(0);

// Step 3: Calculate Dual Thrust parameters
HH = Highest(H, Nday);
HC = Highest(C, Nday);
LL = Lowest(L, Nday);
LC = Lowest(C, Nday);
vRange = MaxList(HH - LC, HC - LL);

// Step 4: Define vOpen and calculate trigger lines
if Time = 0500 then vOpen = Open;
Upperline = vOpen + K1 * vRange;
Bottomline = vOpen - K2 * vRange;

// Step 5: Calculate Chip Flow indicator (from Data4 and Data3)
ChipFlow = Close of Data4 - Close of Data3;

// Determine the color signal based on ChipFlow
SignalColor = iff(ChipFlow > 0, 1, -1); // 1: Positive (Red), -1: Negative (Green)

// Step 6: Combine Dual Thrust and Chip Flow logic
if SignalColor = 1 then begin
    // Enter long positions only if ChipFlow is positive
    if Close crosses over Upperline then 
        Buy next bar at Upperline stop;
end;

if SignalColor = -1 then begin
    // Enter short positions only if ChipFlow is negative
    if Close crosses under Bottomline then 
        SellShort next bar at Bottomline stop;
end;

// Optional: Plot Chip Flow for visual analysis
Plot1(ChipFlow, "DV-UV", iff(SignalColor = 1, Red, Green));
